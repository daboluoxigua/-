(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-302e99d2"],{"495f":function(t,e,s){"use strict";s("3b2b"),s("a481");e["a"]={getUrlKey:function(t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(location.href)||[,""])[1].replace(/\+/g,"%20"))||null}}},"728b":function(t,e,s){"use strict";var a=s("b22c"),o=s.n(a);o.a},"7f7f":function(t,e,s){var a=s("86cc").f,o=Function.prototype,i=/^\s*function ([^ (]*)/,n="name";n in o||s("9e1e")&&a(o,n,{configurable:!0,get:function(){try{return(""+this).match(i)[1]}catch(t){return""}}})},"81fc":function(t,e,s){},8348:function(t,e,s){},8994:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"move"}},[a("div",{ref:"payPage",staticClass:"payPage"},[a("navTop",{attrs:{title:t.title}}),a("div",{ref:"paySrcoll",staticClass:"paySrcoll"},[a("div",[a("div",{staticClass:"payBox mode"},[a("div",{staticClass:"left"},[t._v("就餐方式")]),a("div",{staticClass:"right"},[a("mt-radio",{attrs:{options:t.modeConfig},model:{value:t.switchvue,callback:function(e){t.switchvue=e},expression:"switchvue"}})],1)]),"外卖"==t.switchvue?a("div",{staticClass:"payBox",on:{click:t.addressList}},[a("div",{staticClass:"left"},[t._v("收货地址")]),a("div",{staticClass:"right"},[t.get_addressInfo.address?a("span",[t._v(t._s(t.get_addressInfo.address))]):a("span",[t._v("选择收货地址")]),a("em",{staticClass:"iconfont icon-jiantou"})])]):t._e(),a("div",{staticClass:"payBox dishList"},[a("ul",[t._l(t.selectFoods,function(e,o){return a("li",{key:o},[a("span",{staticClass:"imageName"},[e.imageName?a("img",{attrs:{src:e.imageName,alt:""}}):a("img",{attrs:{src:s("e0e4"),alt:""}})]),a("span",{staticClass:"dishName",class:{lhcent:e.optionList.length>0||e.subItemList.length>0}},[a("span",[t._v(t._s(e.dishName))]),e.optionList.length>0?a("p",t._l(e.optionList,function(e,s){return a("em",{key:s},[t._v(t._s(e.optionName)+" /")])})):e.subItemList.length>0?a("p",t._l(e.subItemList,function(e,s){return a("em",{key:s},[t._v(t._s(e.dishName)+t._s(e.quantity>1?"x"+e.quantity+e.unit:"")+" /")])})):t._e()]),a("span",{staticClass:"dishUnit"},[t._v("x"+t._s(e.quantity+(e.dishUnit?e.dishUnit:"")))]),a("span",{staticClass:"price"},[t._v("￥"+t._s(e.cost.toFixed(2)))])])}),"堂食"!==t.switchvue&&t.setState.takeoutFee>0?a("li",[a("span",[t._v("打包费")]),a("span",{staticStyle:{flex:"0 0 87%","text-align":"right"}},[t._v("￥"+t._s(t.setState.takeoutFee))])]):t._e()],2),a("h2",[a("div",{staticClass:"left"},[t._v("小计")]),a("div",{staticClass:"right"},[a("span",[t._v("￥"+t._s("堂食"!==t.switchvue?(t.setState.cost+t.setState.takeoutFee).toFixed(2):t.setState.cost))]),t.setState.discount>0?a("del",[t._v("￥"+t._s(t.totalPrice.toFixed(2)))]):t._e()])])]),t.setState.accountMember?a("div",{staticClass:"payBox rebate"},[a("ol",[a("li",{staticClass:"denoCoupon"},[a("div",{staticClass:"left"},[t._v("优惠券")]),a("div",{staticClass:"right",on:{click:t.couponShow}},[t._v("\n                "+t._s(t.setState.denoCoupon.word)+"\n                "),a("em",{staticClass:"iconfont icon-jiantou"})])]),a("li",[a("div",{staticClass:"left"},[t._v("积分余额"+t._s(t.setState.credit)+",使用"+t._s(t.creditNum))]),a("div",{staticClass:"right"},[a("mt-switch",{on:{change:t.changeCredit},model:{value:t.credit,callback:function(e){t.credit=e},expression:"credit"}})],1)]),a("li",[a("div",{staticClass:"left"},[t._v("储值余额￥"+t._s(t.setState.balance)+",使用"+t._s(t.balanceNum.toFixed(2)))]),a("div",{staticClass:"right"},[a("mt-switch",{on:{change:t.changeBalance},model:{value:t.balance,callback:function(e){t.balance=e},expression:"balance"}})],1)])])]):t._e(),a("div",{staticClass:"payBox remarks"},[a("div",{staticClass:"left"},[t._v("订单备注")]),a("div",{staticClass:"right"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.bak,expression:"bak"}],attrs:{placeholder:"口味、偏好等其他需求"},domProps:{value:t.bak},on:{blur:t.blurFun,input:function(e){e.target.composing||(t.bak=e.target.value)}}})])])])]),a("div",{staticClass:"paybtn"},[a("div",{staticClass:"left"},[a("span",[t._v("￥"+t._s(t.onSetComputer))]),t.setState.discount>0?a("span",[t._v("已优惠￥"+t._s(t.setState.discount))]):t._e()]),a("div",{staticClass:"right"},[a("button",{staticClass:"pay",on:{click:t.onsubmit}},[t._v(t._s(t.payDesc))])])]),a("coupon",{ref:"coupon",attrs:{Order:t.Order.accountMember},on:{couponData:t.getcouponData}}),a("loading",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}]})],1)])},o=[],i=(s("ac6a"),s("28a5"),s("7f7f"),s("a481"),s("be94")),n=s("18a0"),r=s.n(n),c=s("1fba"),d=s("76a0"),l=s("bc3a"),u=s.n(l),p=s("4328"),h=s.n(p),m=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.showFlag?s("div",{staticClass:"coupon"},[s("div",{staticClass:"couponPop"},[s("h2",[t._v(t._s(t.Order.gradeName))]),s("ul",t._l(t.Order.coupons,function(e,a){return s("li",{key:a,class:e.isElect?"active":"",on:{click:function(s){t.toggle(e)}}},[s("div",{staticClass:"title"},[t._v(t._s(e.title))]),s("div",{staticClass:"time"},[t._v("有效期至 "+t._s(e.failure_time))]),s("div",{staticClass:"checked icon-duigou iconfont"})])}))]),s("div",{staticClass:"list-mask",on:{click:t.hide}})]):t._e()},g=[],f=s("a026"),v={props:{Order:{}},data:function(){return{showFlag:!1,checked:!0,data:{}}},methods:{show:function(){this.showFlag=!0},hide:function(){this.showFlag=!1},toggle:function(t){var e=this;if(t.isElect)f["default"].set(t,"isElect",!1),this.data={},this.$emit("couponData",this.data),this.$forceUpdate();else{for(var s=0;s<this.Order.coupons.length;s++)f["default"].set(this.Order.coupons[s],"isElect",!1);f["default"].set(t,"isElect",!0),this.data={title:t.title,deno:t.deno,coupon_ids:t.coupon_ids[0],products:t.products[0]},this.$forceUpdate(),this.$emit("couponData",this.data),setTimeout(function(){e.hide()},300)}}}},b=v,y=(s("fd78"),s("2877")),w=Object(y["a"])(b,m,g,!1,null,"68c20482",null);w.options.__file="coupon.vue";var _=w.exports,S=s("c17f"),C=s("54a1"),F=s("495f"),O=s("2f62"),T={props:{},data:function(){return{modeConfig:["堂食","外带"],screenHeight:document.body.clientHeight,loading:!1,selectFoods:{},title:window.localStorage.getItem("welcomeSname"),bak:"",couponCodeRef:"",payFlag:0,showFlag:!1,couponData:{},setState:{denoCoupon:{word:""}},switchvue:"堂食",credit:!1,creditNum:0,balance:!1,balanceNum:0,Order:{},comTotalPrice:0,password:"",browserName:window.localStorage.getItem("browserName"),source:1==this.browserName?"支付宝":"微信",openid:window.sessionStorage.getItem("openid")?window.sessionStorage.getItem("openid"):"oNFKzv5kO0nzu4c_iza-L9yMLjvc"}},computed:Object(i["a"])({},Object(O["b"])(["get_selectFoods","get_totalPrice","get_addressInfo"]),{payDesc:function(){return 0==this.payFlag?"结算中":1==this.payFlag?"确定支付":2==this.payFlag?"订单错误":void 0},couponCode:function(){return this.couponCodeRef.length>0},onSetComputer:function(){return this.comTotalPrice=this.setState.cost-(this.couponData.deno?this.couponData.deno:0),this.comTotalPrice<0&&(this.comTotalPrice=0),"外带"!=this.switchvue&&"外卖"!=this.switchvue||(this.comTotalPrice+=this.setState.takeoutFee),this.credit?(this.setState.credit-this.comTotalPrice<=0?this.creditNum=this.setState.credit:this.creditNum=parseInt(this.comTotalPrice),this.comTotalPrice-=this.creditNum):this.creditNum=0,this.balance?(this.setState.balance-this.comTotalPrice<=0?this.balanceNum=this.setState.balance:this.balanceNum=this.comTotalPrice,this.comTotalPrice-=this.balanceNum):this.balanceNum=0,this.comTotalPrice=this.comTotalPrice&&this.comTotalPrice>0?parseInt(100*this.comTotalPrice.toFixed(2))/100:0,this.setState.realcoat=this.comTotalPrice,this.comTotalPrice}}),watch:{switchvue:function(t){this.totalPrice="外卖"==t||"外带"==t?this.get_totalPrice+this.setState.takeoutFee:this.get_totalPrice}},activated:function(){"true"==window.localStorage.getItem("saleOut")&&(this.modeConfig=["堂食","外带","外卖"]),this.selectFoods=this.get_selectFoods,this.totalPrice=this.get_totalPrice,this.show(),this.getAddress(),!this.selectFoods.length>0&&this.$router.replace({path:"/goods",query:{time:(new Date).getTime()}})},methods:Object(i["a"])({},Object(O["c"])(["set_addressInfo"]),{show:function(){var t=this;this.showFlag=!0,this.$nextTick(function(){t.scroll?t.scroll.refresh():t.scroll=new c["a"](t.$refs.paySrcoll,{click:!0}),t.newFastFoodOrder()})},hide:function(){this.showFlag=!1},couponShow:function(){this.Order.accountMember.coupons.length>0&&this.$refs.coupon.show()},changeCredit:function(){var t=this;null!==this.Order.trade_verify&&this.credit&&!this.password&&this.Order.accountMember.trade_verify.credit_verify&&(Object(d["MessageBox"])({$type:"prompt",title:null,message:"请输入密码",inputPlaceholder:"请输入密码",showCancelButton:!0,inputType:"password",showInput:!0}).then(function(e){var s=e.value;if(s.length>0)return t.password=s,void t.$nextTick(function(){t.credit=!0})}).catch(function(){t.credit=!1}),this.$nextTick(function(){t.credit=!1}))},changeBalance:function(){var t=this;null!==this.Order.trade_verify&&this.balance&&!this.password&&this.Order.accountMember.trade_verify.charge_verify&&(Object(d["MessageBox"])({$type:"prompt",title:null,message:"请输入密码",inputPlaceholder:"请输入密码",showCancelButton:!0,inputType:"password",showInput:!0}).then(function(e){var s=e.value;if(s.length>0)return t.password=s,void t.$nextTick(function(){t.balance=!0})}).catch(function(){t.balance=!1}),this.$nextTick(function(){t.balance=!1}))},getcouponData:function(t){this.couponData=t,this.setState.denoCoupon.word=t.title?t.title:this.Order.accountMember.coupons.length+"张可用代金券"},newFastFoodOrder:function(){var t=this,e=this.selectFoods,s={total:this.get_totalPrice,member:window.localStorage.getItem("userIsMember"),source:this.source,discount:0,createdBy:2,customerAmount:1,subtraction:0,orderType:0,paymentStatus:"NOT_PAYED",itemList:e},a={appid:F["a"].getUrlKey("appid"),openid:this.openid,storeid:F["a"].getUrlKey("storeid"),tableid:F["a"].getUrlKey("table"),orderdata:JSON.stringify(s),phoneModel:navigator.userAgent,phone:window.sessionStorage.getItem("phoneNum")?window.sessionStorage.getItem("phoneNum"):""};this.loading=!0,u.a.post("../../wx/newFastFoodOrder",h.a.stringify(a)).then(function(e){t.loading=!1;var s=e.data;if(0==s.result)t.payFlag=1,t.Order=e.data.content,t.setState={isloading:!1,paymented:s.content.paymented,id:s.content.id,total:s.content.total.toFixed(2),accountMember:s.content.accountMember,enterprise:s.content.enterprise,discount:s.content.marketDetailStr.toFixed(2),cost:s.content.cost,realcoat:s.content.cost.toFixed(2),takeoutFee:s.content.takeoutFee,credit:s.content.accountMember?s.content.accountMember.credit:2,balance:s.content.accountMember?parseFloat((parseInt(s.content.accountMember.balance)/100).toFixed(2)):2,denoCoupon:{word:s.content.accountMember?"你有"+s.content.accountMember.coupons.length+"张可用代金券":"暂无可用代金券",use:!1,cost:0,id:""}};else if(1123==s.result){for(var a="",o=s.content.length-1;o>=0;o--)a+=s.content[o].dishName+",";Object(d["Toast"])({className:"toasts",message:a+s.errmsg}),setTimeout(function(){t.$router.go(-1)},2500),t.payFlag=2}else if(1110==s.result){for(var i="",n=s.content.length-1;n>=0;n--)i+=s.content[n]+",";Object(d["Toast"])({className:"toasts",message:i+s.errmsg}),t.payFlag=2}else Object(d["Toast"])({className:"toasts",message:s.errmsg}),t.payFlag=2})},onsubmit:function(){var t=this;if(1!==this.payFlag||this.loading)return!1;var e=0,s=0,a=0;if("堂食"==this.switchvue)e=0,s=parseInt((100*this.setState.cost).toFixed(0)),a=parseInt((100*this.get_totalPrice).toFixed(0));else if(s=parseInt((100*(this.setState.cost+this.setState.takeoutFee)).toFixed(0)),a=parseInt((100*(this.get_totalPrice+this.setState.takeoutFee)).toFixed(0)),"外带"==this.switchvue)e=1;else if("外卖"==this.switchvue){if(!this.get_addressInfo.id)return Object(d["Toast"])({className:"toasts",message:"请选择收货地址"}),!1;e=2}var o={appid:F["a"].getUrlKey("appid"),storeid:F["a"].getUrlKey("storeid"),openid:this.openid,clientip:"192.169.1.106",orderid:this.Order.id,orderType:e,paymentAmount:parseInt((100*this.onSetComputer).toFixed(0)),comment:this.bak,bizId:(new Date).getTime()};o.consumeAmount=s,o.totalAmount=a;var i=this.Order.accountMember;if(window.localStorage.getItem("subscribe")&&(o.subscribe=window.localStorage.getItem("subscribe")),null!=i&&(o.uid=i.uid,o.memberid=i.uid,o.memberName=i.name,o.memberPhoneNumber=i.phone,o.cno=i.uno,o.denoCouponId=this.couponData.coupon_ids?this.couponData.coupon_ids:"",o.products=this.couponData.products,o.denoCouponCash=this.couponData.deno,o.credit=this.creditNum,o.balance=parseInt((100*this.balanceNum).toFixed(0)),o.password=this.password,o.gradeName=i.gradeName),2==e&&(o.deliverCustomerInfoid=this.get_addressInfo.id),this.loading=!0,2==this.browserName)u.a.post("../../wx/fastFoodPayOrder",h.a.stringify(o)).then(function(e){t.loading=!1;var s=e.data,a=t.Order.id,o=t;0==s.result?t.setState.paymented&&parseFloat(t.setState.realcoat)>0?r.a.chooseWXPay({appId:s.content.appId,timestamp:s.content.timeStamp,nonceStr:s.content.nonceStr,package:s.content.package,signType:s.content.signType,paySign:s.content.paySign,success:function(){if(sessionStorage.setItem("orderType",1),null!==s.content.subscribeUrl){var t=window.location.href;t=t.replace("/payPage","/PaySuccess?orderid="+a),t=encodeURIComponent(t.replace("http://sz.canxingjian.com","http://www.smarant.com"));s.content.templateId;window.location.href=s.content.subscribeUrl+"&redirect_url="+t+"&reserved="+a+"#wechat_redirect"}else o.$router.push({path:"/PaySuccess",query:{orderid:a}})},cancel:function(){console.log("取消支付"),o.newFastFoodOrder()},fail:function(){console.log("支付失败"),o.newFastFoodOrder()}}):o.$router.push({path:"/PaySuccess",query:{orderid:a}}):-8==s.result?t.setState.paymented&&parseFloat(t.setState.realcoat)>0?WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:s.content.appId,timeStamp:s.content.timeStamp,nonceStr:s.content.nonceStr,package:s.content.package,signType:s.content.signType,paySign:s.content.paySign},function(t){"get_brand_wcpay_request:ok"==t.err_msg?(sessionStorage.setItem("orderType",1),o.$router.push({path:"/PaySuccess",query:a})):(t.err_msg,o.newFastFoodOrder())}):t.$router.push({path:"/PaySuccess",query:{orderid:a}}):3056==s.result||3055==s.result||1002==s.result?(Object(d["Toast"])({className:"toasts",message:s.errmsg}),o.newFastFoodOrder(),o.password="",o.credit=!1,o.balance=!1):1123==s.result?(Object(d["Toast"])({className:"toasts",message:s.errmsg}),setTimeout(function(){t.$router.go(-1)},2500)):Object(d["Toast"])({className:"toasts",message:s.errmsg})});else if(1==this.browserName){var n=this.Order.id;o.userid=this.openid,o.type=3,u.a.post("../../alipay/fastFoodPayOrder",h.a.stringify(o)).then(function(e){t.loading=!1;var s=t,a=e.data;0==a.result?t.setState.paymented&&parseFloat(t.setState.realcoat)>0?(document.body.innerHTML+=a.content,document.forms[0].submit()):t.$router.push({path:"/PaySuccess",query:{orderid:n}}):-8==a.result?t.setState.paymented&&parseFloat(t.setState.realcoat)>0?AlipayJSBridge.call("tradePay",{tradeNO:a.content.tradeNO},function(e){"9000"==e.resultCode&&t.$router.push({path:"/PaySuccess",query:n}),"4000"==e.resultCode||"6001"==e.resultCode||"6002"==e.resultCode?(s.newFastFoodOrder(),s.password="",s.credit=!1,s.balance=!1):1123==e.resultCode&&(Object(d["Toast"])({className:"toasts",message:e.errmsg}),setTimeout(function(){t.$router.go(-1)},2500))}):t.$router.push({path:"/PaySuccess",query:{orderid:n}}):(Object(d["Toast"])({className:"toasts",message:a.errmsg}),setTimeout(function(){t.$router.go(-1)},2500))})}},blurFun:function(){document.body.scrollTop=0},addressList:function(){this.$router.push({path:"/addressList"})},getAddress:function(){var t=this,e=!0,s={appid:window.localStorage.getItem("appid"),storeid:window.localStorage.getItem("storeid"),customerid:window.sessionStorage.getItem("openid")};u.a.post("../../wx/getDeliverCustomerInfoByCustomerid",h.a.stringify(s)).then(function(s){if(0==s.data.result){var a=s.data.content,o=window.localStorage.getItem("point");o&&(o=o.split(","),AMap&&a.forEach(function(s){if(s.xy=JSON.parse(s.xy),s.xy instanceof Array){var a=AMap.GeometryUtil.distance(o,s.xy);a<3e3&&1==s.defaultCheck&&(t.set_addressInfo(s),e=!1),e&&t.set_addressInfo("")}}))}})},getEnterprisePlan:function(){var t=this;this.couponCode?u.a.post("../../public/waimai/meituan/shop/validationSetout",h.a.stringify({appId:this.$route.query.appid,storeId:this.$route.query.storeid,brandId:this.$route.query.brandid,couponCode:this.couponCodeRef})).then(function(e){var s=e.data;if(!s.data)return Object(d["Toast"])({className:"toasts",message:"没有该优惠码，请重新输入"}),t.couponCodeRef="",!1;var a=s.data.enterpriseMarket,o=0;if(!(t.setState.cost>=a.minConsumption))return Object(d["Toast"])({className:"toasts",message:"该优惠满"+a.minConsumption+"可用"}),t.couponCodeRef="",!1;if(t.setState.couponCode.word=s.data.promoCode,0==a.marketType){var i=parseFloat(t.setState.cost.toFixed(2))-parseFloat(t.setState.cost.toFixed(2))*a.rate;o=parseFloat(i.toFixed(2))}else o=parseFloat(a.cash);t.setState.couponCode.model=!1,t.setState.couponCode.cost=o}):Object(d["Toast"])({className:"toasts",message:"请先输入优惠码"})}}),components:{loading:C["default"],coupon:_,navTop:S["a"]}},k=T,x=(s("728b"),Object(y["a"])(k,a,o,!1,null,"56ee8b23",null));x.options.__file="payPage.vue";e["default"]=x.exports},b22c:function(t,e,s){},b315:function(t,e,s){"use strict";var a=s("8348"),o=s.n(a);o.a},be94:function(t,e,s){"use strict";function a(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function o(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{},o=Object.keys(s);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(s).filter(function(t){return Object.getOwnPropertyDescriptor(s,t).enumerable}))),o.forEach(function(e){a(t,e,s[e])})}return t}s.d(e,"a",function(){return o})},c17f:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"nav"},[s("div",{staticClass:"nav-left",on:{click:t.routerback}},[s("i",{staticClass:"iconfont"},[t._v("")])]),s("h2",[t._v(t._s(t.title))])])},o=[],i={props:["title"],methods:{routerback:function(){return window.history.length<=1?(this.$router.push({path:"/"}),!1):(this.$router.go(-1),!1)}}},n=i,r=(s("b315"),s("2877")),c=Object(r["a"])(n,a,o,!1,null,null,null);c.options.__file="navTop.vue";e["a"]=c.exports},e0e4:function(t,e,s){t.exports=s.p+"assets/img/no.d77dab99.png"},fd78:function(t,e,s){"use strict";var a=s("81fc"),o=s.n(a);o.a}}]);